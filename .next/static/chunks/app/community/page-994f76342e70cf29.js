(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6028],{715:(e,t,s)=>{Promise.resolve().then(s.bind(s,8278))},2048:(e,t,s)=>{"use strict";s.d(t,{Cf:()=>u,Es:()=>h,Fs:()=>p,L3:()=>x,c7:()=>m,lG:()=>l,rr:()=>g,zM:()=>o});var a=s(4648);s(8068);var i=s(5334),n=s(457),r=s(6895);function l(e){let{...t}=e;return(0,a.jsx)(i.bL,{"data-slot":"dialog",...t})}function o(e){let{...t}=e;return(0,a.jsx)(i.l9,{"data-slot":"dialog-trigger",...t})}function c(e){let{...t}=e;return(0,a.jsx)(i.ZL,{"data-slot":"dialog-portal",...t})}function d(e){let{className:t,...s}=e;return(0,a.jsx)(i.hJ,{"data-slot":"dialog-overlay",className:(0,r.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function u(e){let{className:t,children:s,...l}=e;return(0,a.jsxs)(c,{"data-slot":"dialog-portal",children:[(0,a.jsx)(d,{}),(0,a.jsxs)(i.UC,{"data-slot":"dialog-content",className:(0,r.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...l,children:[s,(0,a.jsxs)(i.bm,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,a.jsx)(n.A,{}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function m(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"dialog-header",className:(0,r.cn)("flex flex-col gap-2 text-center sm:text-left",t),...s})}function h(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"dialog-footer",className:(0,r.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...s})}function x(e){let{className:t,...s}=e;return(0,a.jsx)(i.hE,{"data-slot":"dialog-title",className:(0,r.cn)("text-lg leading-none font-semibold",t),...s})}function g(e){let{className:t,...s}=e;return(0,a.jsx)(i.VY,{"data-slot":"dialog-description",className:(0,r.cn)("text-muted-foreground text-sm",t),...s})}function p(e){let{className:t,children:s,...l}=e;return(0,a.jsxs)(c,{"data-slot":"dialog-portal",children:[(0,a.jsx)(d,{}),(0,a.jsxs)(i.UC,{"data-slot":"dialog-content",className:(0,r.cn)("bg-background fixed top-[50%] left-[50%] z-50 grid w-auto min-w-[90vw] max-w-[95vw] sm:min-w-[60vw] sm:max-w-[80vw] md:min-w-[50vw] md:max-w-[70vw] lg:min-w-[40vw] lg:max-w-[60vw] max-h-[90vh] translate-x-[-50%] translate-y-[-50%] rounded-lg border p-4 sm:p-6 shadow-lg duration-200 overflow-auto",t),...l,children:[(0,a.jsxs)(i.bm,{className:"absolute top-4 right-4 p-2 opacity-70 transition-opacity hover:opacity-100 focus:outline-none",children:[(0,a.jsx)(n.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]}),(0,a.jsx)("div",{className:"overflow-auto max-h-[80vh]",children:s})]})]})}},2623:(e,t,s)=>{"use strict";s.d(t,{BK:()=>o,eu:()=>l,q5:()=>c});var a=s(4648),i=s(8068),n=s(7761),r=s(6895);let l=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,a.jsx)(n.bL,{ref:t,className:(0,r.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...i})});l.displayName=n.bL.displayName;let o=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,a.jsx)(n._V,{ref:t,className:(0,r.cn)("aspect-square h-full w-full",s),...i})});o.displayName=n._V.displayName;let c=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,a.jsx)(n.H4,{ref:t,className:(0,r.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...i})});c.displayName=n.H4.displayName},3292:(e,t,s)=>{"use strict";s.d(t,{p:()=>n});var a=s(4648);s(8068);var i=s(6895);function n(e){let{className:t,type:s,...n}=e;return(0,a.jsx)("input",{type:s,"data-slot":"input",className:(0,i.cn)("border-input file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...n})}},4558:(e,t,s)=>{"use strict";s.d(t,{A:()=>y});var a=s(4648),i=s(7124),n=s(6869),r=s.n(n),l=s(8068),o=s(2086),c=s(6140),d=s(5392),u=s(9971),m=s(533),h=s(2544),x=s(9442),g=s(2503),p=s(457),f=s(3736),v=s(5772),b=s(8235);function y(){var e;let{data:t,status:s}=(0,i.useSession)(),[n,y]=(0,l.useState)(!1),w=(0,o.usePathname)(),j=[{href:"/dashboard",label:"Bảng điều khiển",icon:(0,a.jsx)(c.A,{size:16}),show:"authenticated"===s},{href:"/community",label:"Cộng đồng",icon:(0,a.jsx)(d.A,{size:16}),show:"authenticated"===s},{href:"/mydevices",label:"Thiết bị của t\xf4i",icon:(0,a.jsx)(u.A,{size:16}),show:"authenticated"===s},{href:"/servicepackage",label:"G\xf3i dịch vụ",icon:(0,a.jsx)(m.A,{size:16}),show:"authenticated"===s},{href:"/profile",label:"Hồ sơ",icon:(0,a.jsx)(h.A,{size:16}),show:"authenticated"===s},{href:"/admin",label:"Quản trị",icon:(0,a.jsx)(x.A,{size:16}),show:(null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.role)==="admin"}],N={initial:{scale:1},hover:{scale:1.03,transition:{type:"spring",stiffness:500,damping:30}},tap:{scale:.97,transition:{type:"spring",stiffness:600,damping:25}},active:{scale:1.05,transition:{type:"spring",stiffness:400,damping:20}}},k={initial:{opacity:0,x:-5},animate:{opacity:1,x:0,transition:{type:"spring",stiffness:400,damping:20,mass:.4}},exit:{opacity:0,x:-5,transition:{duration:.1}}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("nav",{className:"bg-white shadow-md fixed top-0 left-0 w-full z-50",children:[(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,a.jsx)(r(),{href:"/",className:"flex items-center space-x-1 text-lg font-semibold text-blue-600 hover:opacity-80 transition",children:(0,a.jsxs)("svg",{width:"150",height:"40",viewBox:"0 0 120 40",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("image",{href:"hato.png",x:"0",y:"5",height:"30px"}),(0,a.jsx)("text",{x:"55",y:"25",fontSize:"17",fill:"#2657A4",fontWeight:"bold",children:"Hato"}),(0,a.jsx)("text",{x:"95",y:"25",fontSize:"12",fill:"gray",children:".cloud"})]})}),(0,a.jsxs)("div",{className:"hidden lg:flex space-x-3",children:[j.filter(e=>e.show).map(e=>(0,a.jsx)(v.P.div,{variants:N,initial:"initial",whileHover:"hover",whileTap:"tap",animate:w===e.href?"active":"initial",layout:!0,children:(0,a.jsxs)(r(),{href:e.href,className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-md text-sm transition whitespace-nowrap ".concat(w===e.href?"text-blue-500 font-sm bg-blue-100":"text-gray-700 bg-gray-100 hover:text-blue-500 hover:bg-blue-100"),children:[e.icon,(0,a.jsx)("span",{children:e.label})]})},e.href)),"loading"===s?(0,a.jsx)("button",{className:"px-3 py-1.5 text-sm bg-gray-200 rounded-md flex items-center justify-center whitespace-nowrap",children:(0,a.jsx)(g.A,{className:"animate-spin h-5 w-5 text-gray-500"})}):t?(0,a.jsx)(v.P.button,{whileHover:{scale:1.03},whileTap:{scale:.97},transition:{type:"spring",stiffness:500,damping:30},onClick:()=>(0,i.signOut)({callbackUrl:"/"}),className:"bg-red-500 text-white px-3 py-1.5 text-sm rounded-md hover:bg-red-600 transition whitespace-nowrap",children:"Đăng xuất"}):(0,a.jsx)(v.P.button,{whileHover:{scale:1.03},whileTap:{scale:.97},transition:{type:"spring",stiffness:500,damping:30},onClick:()=>(0,i.signIn)("google"),className:"bg-blue-500 text-white px-3 py-1.5 text-sm rounded-md hover:bg-blue-600 transition whitespace-nowrap",children:"Đăng nhập"})]}),(0,a.jsx)("div",{className:"lg:hidden",children:(0,a.jsx)(v.P.button,{whileTap:{scale:.9},transition:{type:"spring",stiffness:600,damping:20},onClick:()=>y(!n),className:"text-gray-700",children:n?(0,a.jsx)(p.A,{size:28}):(0,a.jsx)(f.A,{size:28})})})]})}),(0,a.jsx)(b.N,{children:n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.P.div,{variants:{initial:{opacity:0},animate:{opacity:.5,transition:{duration:.2}},exit:{opacity:0,transition:{duration:.15}}},initial:"initial",animate:"animate",exit:"exit",className:"fixed inset-0 z-40",onClick:()=>y(!1)}),(0,a.jsxs)(v.P.div,{variants:{initial:{opacity:0,y:-10},animate:{opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:25,mass:.5}},exit:{opacity:0,y:-10,transition:{duration:.15}}},initial:"initial",animate:"animate",exit:"exit",layout:!0,className:"lg:hidden bg-white shadow-md py-4 px-6 space-y-4 absolute top-16 left-0 w-full z-50",children:[j.filter(e=>e.show).map((e,t)=>(0,a.jsx)(v.P.div,{variants:k,initial:"initial",animate:"animate",exit:"exit",transition:{delay:.05*t},children:(0,a.jsxs)(r(),{href:e.href,className:"block flex items-center space-x-2 text-base transition ".concat(w===e.href?"text-blue-500 font-sm bg-blue-100 rounded-md px-2 py-1":"text-gray-700 hover:text-blue-500 hover:bg-blue-50"),onClick:()=>y(!1),children:[e.icon,(0,a.jsx)("span",{children:e.label})]})},e.href)),"loading"===s?(0,a.jsx)("button",{className:"block w-full text-center bg-gray-200 text-gray-500 px-4 py-2 rounded-lg text-base flex items-center justify-center",children:(0,a.jsx)(g.A,{className:"animate-spin h-5 w-5"})}):t?(0,a.jsx)(v.P.button,{whileHover:{scale:1.03},whileTap:{scale:.97},transition:{type:"spring",stiffness:500,damping:30},onClick:()=>{y(!1),(0,i.signOut)({callbackUrl:"/"})},className:"block w-full text-left bg-red-500 text-white px-4 py-2 rounded-lg text-base hover:bg-red-600 transition",children:"Đăng xuất"}):(0,a.jsx)(v.P.button,{whileHover:{scale:1.03},whileTap:{scale:.97},transition:{type:"spring",stiffness:500,damping:30},onClick:()=>{y(!1),(0,i.signIn)("google")},className:"block w-full text-center bg-blue-500 text-white px-4 py-2 rounded-lg text-base hover:bg-blue-600 transition",children:"Đăng nhập"})]})]})})]}),(0,a.jsx)("div",{className:"pt-16"})]})}},5520:(e,t,s)=>{"use strict";s.d(t,{$:()=>o});var a=s(4648);s(8068);var i=s(9554),n=s(3300),r=s(6895);let l=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-[color,box-shadow] disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40",outline:"border border-input bg-background shadow-xs hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function o(e){let{className:t,variant:s,size:n,asChild:o=!1,...c}=e,d=o?i.DX:"button";return(0,a.jsx)(d,{"data-slot":"button",className:(0,r.cn)(l({variant:s,size:n,className:t})),...c})}},6895:(e,t,s)=>{"use strict";s.d(t,{cn:()=>n});var a=s(6018),i=s(914);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,i.QP)((0,a.$)(t))}},8278:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>M});var a=s(4648),i=s(8068),n=s(7055),r=s.n(n),l=s(7124),o=s(5520),c=s(3292),d=s(2623),u=s(9777),m=s(6125),h=s(5533),x=s(6727),g=s(9160),p=s(6927),f=s(416),v=s(6854),b=s(457),y=s(2503),w=s(8638),j=s(4652),N=s(4747),k=s(9196),C=s(9881),S=s(1193),A=s(8193),z=s(8821),P=s(8235),T=s(5772),O=s(2048),E=s(1875),U=s(1293);function D(){var e,t,s;let{data:n}=(0,l.useSession)(),[D,I]=(0,i.useState)([]),[M,$]=(0,i.useState)([]),[L,F]=(0,i.useState)(""),[H,R]=(0,i.useState)([]),[_,B]=(0,i.useState)([]),[J,K]=(0,i.useState)(null),[q,V]=(0,i.useState)(null),[Y,G]=(0,i.useState)(null),[X,W]=(0,i.useState)(null),[Q,Z]=(0,i.useState)(1),[ee,et]=(0,i.useState)({x:0,y:0}),[es,ea]=(0,i.useState)(!1),[ei,en]=(0,i.useState)({x:0,y:0}),[er,el]=(0,i.useState)(!1),[eo,ec]=(0,i.useState)(""),[ed,eu]=(0,i.useState)(""),[em,eh]=(0,i.useState)("all"),[ex,eg]=(0,i.useState)(!0),[ep,ef]=(0,i.useState)(!1),[ev,eb]=(0,i.useState)(new Set),[ey,ew]=(0,i.useState)(null),ej=(0,i.useRef)(null),eN=(0,i.useRef)(null),ek=(0,i.useRef)(null),eC=(0,i.useRef)(new Map),eS=(0,i.useRef)(null),eA=(0,i.useRef)(null),ez=(0,i.useRef)(null),eP=Number(null==n?void 0:null===(e=n.user)||void 0===e?void 0:e.id),eT=(null==n?void 0:null===(t=n.user)||void 0===t?void 0:t.role)==="admin",eO=(L.trim()||H.length>0)&&!ep;(0,i.useEffect)(()=>{if(!n){$([]),eg(!1);return}let e=async()=>{let e=await fetch("/api/community-chatapp/messages");e.ok?$(await e.json()):(console.error("Failed to fetch messages:",await e.text()),$([])),eg(!1)};(async()=>{let e=await fetch("/api/community-chatapp/users");e.ok?I(await e.json()):console.error("Failed to fetch users:",await e.text())})(),e(),(async()=>{await fetch("/api/community-chatapp/online",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:eP}),credentials:"include"})})();let t=new(r())("cb2abd19936ed09d7892",{cluster:"ap1",authEndpoint:"/api/community-chatapp/auth"}),s=t.subscribe("community-chat");s.bind("new-message",e=>$(t=>[...t,e])),s.bind("update-message",e=>$(t=>t.map(t=>t.id===e.id?e:t))),s.bind("new-reaction",e=>$(t=>t.map(t=>t.id===e.id?e:t))),s.bind("message-seen",e=>$(t=>t.map(t=>t.id===e.id?e:t))),s.bind("typing",e=>{e.userId!==eP&&(eb(t=>new Set(t).add(e.userId)),setTimeout(()=>eb(t=>{let s=new Set(t);return s.delete(e.userId),s}),2e3))}),s.bind("user-status",e=>{I(t=>t.map(t=>t.id===e.userId?{...t,isOnline:e.isOnline}:t))});let a=()=>{navigator.sendBeacon("/api/community-chatapp/offline",JSON.stringify({userId:eP}))};return window.addEventListener("beforeunload",a),()=>{window.removeEventListener("beforeunload",a),s.unbind_all(),s.unsubscribe(),t.disconnect()}},[n,eP]),(0,i.useEffect)(()=>{let e=()=>{if(eS.current&&ej.current){let e=eS.current.clientHeight-216;ej.current.style.height="".concat(e,"px")}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[M.length]),(0,i.useEffect)(()=>{if(ej.current){var e;let{scrollHeight:t,clientHeight:s,scrollTop:a}=ej.current;(t-a-s<100||(null===(e=M[M.length-1])||void 0===e?void 0:e.userId)===eP)&&ej.current.scrollTo({top:t,behavior:"smooth"})}},[M,ev,eP]),(0,i.useEffect)(()=>{let e=e=>{eA.current&&!eA.current.contains(e.target)&&el(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let eE=async e=>{try{let t=await fetch("/api/community-chatapp/seen",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messageId:e}),credentials:"include"});if(!t.ok){let e=await t.text();console.error("Failed to mark as seen (status ".concat(t.status,"):"),e||"No error message returned")}}catch(e){console.error("Error in markAsSeen:",e)}};(0,i.useEffect)(()=>{let e=new IntersectionObserver(e=>{e.forEach(async e=>{if(e.isIntersecting){let t=Number(e.target.getAttribute("data-message-id")),s=M.find(e=>e.id===t);!s||s.isDeleted||s.seenBy.some(e=>e.userId===eP)||await eE(t)}})},{root:ej.current,threshold:.5});return eC.current.forEach(t=>e.observe(t)),()=>e.disconnect()},[M,eP]);let eU=async()=>{if(!eO||!eP)return;ef(!0);let e=new FormData;e.append("content",L.trim()),(null==J?void 0:J.id)&&(e.append("replyToId",J.id.toString()),await eE(J.id)),H.forEach(t=>e.append("images",t));let t=await fetch("/api/community-chatapp/messages",{method:"POST",body:e,credentials:"include"});t.ok?(F(""),R([]),B([]),K(null),eN.current&&(eN.current.value=""),ej.current&&ej.current.scrollTo({top:ej.current.scrollHeight,behavior:"smooth"})):console.error("Failed to send message:",await t.text()),ef(!1)},eD=e=>{if(Q<=1)return;ea(!0);let t="touches"in e?e.touches[0].clientX:e.clientX,s="touches"in e?e.touches[0].clientY:e.clientY;en({x:t-ee.x,y:s-ee.y})},eI=e=>{if(!es)return;let t="touches"in e?e.touches[0].clientX:e.clientX,s="touches"in e?e.touches[0].clientY:e.clientY,a=200*(Q-1);et({x:Math.max(-a,Math.min(a,t-ei.x)),y:Math.max(-a,Math.min(a,s-ei.y))})},eM=()=>ea(!1),e$=async(e,t)=>{let s=await fetch("/api/community-chatapp/reactions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messageId:e,emoji:t}),credentials:"include"});s.ok?V(null):console.error("Failed to add reaction:",await s.text())},eL=e=>{var t;K(e),null===(t=ek.current)||void 0===t||t.focus()},eF=async e=>{if(!eT)return;let t=M.find(t=>t.id===e);if(!t)return;let s=await fetch("/api/community-chatapp/messages/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,isPinned:!t.isPinned}),credentials:"include"});s.ok||console.error("Failed to pin message:",await s.text())},eH=async e=>{if(!eT)return;let t=await fetch("/api/community-chatapp/messages/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isDeleted:!0}),credentials:"include"});t.ok||console.error("Failed to delete message:",await t.text())},eR=e=>{let t=eC.current.get(e);t&&ej.current&&(t.scrollIntoView({behavior:"smooth",block:"center"}),W(e),setTimeout(()=>W(null),2e3))},e_=e=>{ew(e),V(null)},eB=e=>V(q===e?null:e),eJ=()=>{eu(eo),el(!1)},eK=M.filter(e=>(!ed||!!e.content.toLowerCase().includes(ed.toLowerCase()))&&("images"===em?e.imageUrls.length>0&&!e.isDeleted:"links"!==em||e.content.includes("http")&&!e.isDeleted)),eq=M.filter(e=>e.isPinned&&!e.isDeleted),eV=e=>{let t=new Date,s=new Date(e);return(t.getTime()-s.getTime())/864e5>3?(0,E.GP)(s,"dd/MM/yyyy HH:mm"):(0,U.m)(s,{addSuffix:!0})},eY=(e,t)=>{if(e.ctrlKey){let s=t.match(/(https?:\/\/[^\s]+)/);s&&(window.open(s[0],"_blank"),e.preventDefault())}},eG=e=>e.isOnline;return(0,a.jsxs)("div",{className:"h-full flex flex-col md:flex-row gap-4 p-4 bg-gray-100 font-['Inter']",ref:eS,children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden flex-1 flex flex-col",children:[(0,a.jsxs)("div",{className:"p-4 border-b bg-gray-50 flex items-center justify-between chat-header",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(m.A,{className:"h-5 w-5 text-gray-600"}),(0,a.jsx)("h2",{className:"text-base font-medium text-gray-700",children:"Community Chat"})]}),(0,a.jsxs)("div",{className:"relative",ref:eA,children:[(0,a.jsx)(o.$,{variant:"ghost",size:"sm",onClick:()=>el(e=>!e),className:"text-gray-600 hover:bg-gray-200",children:(0,a.jsx)(h.A,{className:"h-5 w-5"})}),(0,a.jsx)(P.N,{children:er&&(0,a.jsx)(T.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute right-0 mt-1 w-52 bg-white border border-gray-200 rounded-md shadow-md z-10",children:(0,a.jsxs)("div",{className:"p-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,a.jsx)(c.p,{value:eo,onChange:e=>ec(e.target.value),placeholder:"Search...",className:"w-full text-sm border-gray-300 focus:border-blue-500",onKeyDown:e=>"Enter"===e.key&&eJ()}),(0,a.jsx)(o.$,{variant:"ghost",size:"sm",onClick:eJ,className:"text-blue-500 hover:bg-blue-100",children:(0,a.jsx)(x.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)(o.$,{variant:"ghost",size:"sm",className:"w-full justify-start text-blue-500 hover:bg-blue-100 text-sm",onClick:()=>{eh("images"),el(!1)},children:[(0,a.jsx)(g.A,{className:"h-4 w-4 mr-1"})," Only Images"]}),(0,a.jsxs)(o.$,{variant:"ghost",size:"sm",className:"w-full justify-start text-blue-500 hover:bg-blue-100 text-sm",onClick:()=>{eh("links"),el(!1)},children:[(0,a.jsx)(p.A,{className:"h-4 w-4 mr-1"})," Only Links"]}),(0,a.jsxs)(o.$,{variant:"ghost",size:"sm",className:"w-full justify-start text-blue-500 hover:bg-blue-100 text-sm",onClick:()=>{eh("all"),ec(""),eu(""),el(!1)},children:[(0,a.jsx)(f.A,{className:"h-4 w-4 mr-1"})," Show All"]})]})})})]})]}),eq.length>0&&(0,a.jsx)("div",{className:"p-1 bg-gray-50 border-b pinned-messages",children:eq.map(e=>(0,a.jsxs)(T.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"flex items-center gap-1 text-sm text-blue-500 cursor-pointer p-1 rounded group hover:bg-blue-100 transition-colors duration-200",onClick:()=>eR(e.id),children:[(0,a.jsx)(v.A,{className:"h-4 w-4 shrink-0"}),(0,a.jsx)("span",{className:"truncate flex-1",children:e.content?"".concat(e.content.slice(0,48),"..."):"".concat(e.imageUrls.length," ảnh")}),eT&&(0,a.jsx)(o.$,{variant:"ghost",size:"sm",className:"p-0 h-5 w-5 text-blue-500 hover:text-blue-700 hover:bg-blue-200 rounded-full transition-colors duration-200",onClick:t=>{t.stopPropagation(),eF(e.id)},children:(0,a.jsx)(b.A,{className:"h-4 w-4"})})]},e.id))}),(0,a.jsx)("div",{className:"overflow-y-auto p-2 flex-1 bg-white",ref:ej,children:ex?(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)(y.A,{className:"h-7 w-7 animate-spin text-blue-500"})}):0===M.length?(0,a.jsx)("div",{className:"flex justify-center items-center h-full text-gray-500",children:(0,a.jsx)("p",{children:"No messages yet. Start the conversation!"})}):(0,a.jsxs)(P.N,{children:[eK.map(e=>{var t,s;let i=e.userId===eP,n=e.replyToId?M.find(t=>t.id===e.replyToId):null;return(0,a.jsx)(T.P.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.95},transition:{duration:.3,ease:"easeOut"},ref:t=>{t&&eC.current.set(e.id,t)},className:"flex ".concat(i?"justify-end":"justify-start"," ").concat(X===e.id?"bg-yellow-50":""," mb-2"),"data-message-id":e.id,children:(0,a.jsxs)("div",{className:"flex items-start gap-2 max-w-[65%] ".concat(i?"flex-row-reverse":"flex-row"),children:[(0,a.jsxs)(d.eu,{children:[(0,a.jsx)(d.BK,{src:null!==(s=e.user.avatar)&&void 0!==s?s:"https://picsum.photos/150"}),(0,a.jsx)(d.q5,{children:(null===(t=e.user.name)||void 0===t?void 0:t[0])||"U"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[(0,a.jsxs)("span",{children:[e.user.name||"Unknown"," • ",eV(e.createdAt)]}),!e.isDeleted&&(0,a.jsx)(o.$,{variant:"ghost",size:"sm",className:"p-0 h-5 w-5 hover:bg-gray-200",onClick:()=>eB(e.id),children:(0,a.jsx)(h.A,{className:"h-4 w-4 text-gray-600"})})]}),n&&(0,a.jsxs)("div",{className:"text-xs text-gray-400 bg-gray-100 p-1 rounded mb-1 cursor-pointer hover:bg-gray-200",onClick:()=>eR(e.replyToId),children:[n.user.name||"Unknown",": ",n.content.slice(0,36),"..."]}),(0,a.jsx)("div",{className:"p-2 rounded-md text-sm shadow-sm ".concat(e.isDeleted?"bg-gray-100 text-gray-400 italic":i?"bg-blue-500 text-white":"bg-gray-50 text-gray-800 border border-gray-200"),children:e.isDeleted?(0,a.jsx)("p",{children:"Message has been deleted by admin"}):(0,a.jsxs)(a.Fragment,{children:[e.content&&(0,a.jsx)("p",{onClick:t=>eY(t,e.content),className:"cursor-pointer",children:e.content}),Array.isArray(e.imageUrls)&&e.imageUrls.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:e.imageUrls.map((e,t)=>(0,a.jsx)(z.default,{src:e,alt:"Uploaded ".concat(t),width:96,height:96,className:"max-w-[96px] max-h-[96px] rounded cursor-pointer object-cover hover:opacity-80 transition-opacity",onClick:()=>G(e)},t))})]})}),(0,a.jsx)("div",{className:"flex gap-1 mt-1",children:Object.entries(e.reactions.reduce((e,t)=>(e[t.emoji]=(e[t.emoji]||0)+1,e),{})).map(t=>{let[s,i]=t;return(0,a.jsxs)(u.E,{variant:"outline",className:"text-xs cursor-pointer bg-gray-50 text-gray-600 border-gray-200 hover:bg-gray-100",onClick:()=>!e.isDeleted&&e$(e.id,s),children:[s," ",i]},s)})}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-1 mt-1",children:[e.seenBy.filter(e=>e.userId!==eP).slice(0,3).map(e=>{var t,s,i,n;return(0,a.jsxs)(d.eu,{className:"h-5 w-5",children:[(0,a.jsx)(d.BK,{src:null!==(n=null===(t=e.user)||void 0===t?void 0:t.avatar)&&void 0!==n?n:"https://picsum.photos/150"}),(0,a.jsx)(d.q5,{className:"bg-gray-200 text-gray-600 text-xs",children:(null===(i=e.user)||void 0===i?void 0:null===(s=i.name)||void 0===s?void 0:s[0])||"U"})]},e.userId)}),e.seenBy.length>3&&(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["+",e.seenBy.length-3]})]}),(0,a.jsx)(P.N,{children:q===e.id&&!e.isDeleted&&(0,a.jsx)(T.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"absolute right-0 bg-white border border-gray-200 rounded-md p-1 shadow-md z-10",style:{top:1===e.id?"36px":"-36px"},children:(0,a.jsxs)("div",{className:"flex gap-1",children:[["\uD83D\uDC4D","❤️","\uD83D\uDE02","\uD83D\uDE22","\uD83D\uDE21"].map(t=>(0,a.jsx)(o.$,{variant:"ghost",size:"sm",className:"p-0 h-6 w-6 hover:bg-blue-100",onClick:()=>e$(e.id,t),children:t},t)),(0,a.jsx)(o.$,{variant:"ghost",size:"sm",className:"p-0 h-6 w-6 hover:bg-blue-100",onClick:()=>eL(e),children:(0,a.jsx)(w.A,{className:"h-4 w-4 text-blue-500"})}),eT&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.$,{variant:"ghost",size:"sm",className:"p-0 h-6 w-6 hover:bg-blue-100",onClick:()=>eF(e.id),children:(0,a.jsx)(v.A,{className:"h-4 w-4 text-blue-500"})}),(0,a.jsx)(o.$,{variant:"ghost",size:"sm",className:"p-0 h-6 w-6 hover:bg-red-100",onClick:()=>eH(e.id),children:(0,a.jsx)(j.A,{className:"h-4 w-4 text-red-500"})})]}),(0,a.jsx)(o.$,{variant:"ghost",size:"sm",className:"p-0 h-6 w-6 hover:bg-blue-100",onClick:()=>e_(e),children:(0,a.jsx)(N.A,{className:"h-4 w-4 text-blue-500"})})]})})})]})]})},e.id)}),ev.size>0&&(0,a.jsx)(T.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex justify-start mb-2",children:(0,a.jsxs)("div",{className:"flex items-start gap-2 max-w-[65%]",children:[(0,a.jsx)(d.eu,{className:"h-7 w-7",children:(0,a.jsx)(d.q5,{className:"bg-gray-200 text-gray-600 text-sm",children:"..."})}),(0,a.jsx)("div",{className:"p-2 rounded-md text-sm bg-gray-100 text-gray-500 flex items-center gap-1",children:(0,a.jsx)("span",{className:"animate-pulse",children:"Đang nhập..."})})]})})]})}),Y&&(0,a.jsx)(T.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:()=>G(null),onWheel:e=>{e.preventDefault(),Z(t=>Math.max(.5,Math.min(t+(e.deltaY<0?.1:-.1),3)))},children:(0,a.jsxs)("div",{className:"relative",onClick:e=>e.stopPropagation(),onMouseDown:eD,onMouseMove:eI,onMouseUp:eM,onMouseLeave:eM,onTouchStart:eD,onTouchMove:eI,onTouchEnd:eM,style:{cursor:Q>1?"grab":"default"},children:[(0,a.jsx)(z.default,{src:Y,alt:"Zoomed",width:960,height:960,className:"max-w-[90vw] max-h-[90vh] rounded-md object-contain",style:{transform:"scale(".concat(Q,") translate(").concat(ee.x,"px, ").concat(ee.y,"px)"),transition:es?"none":"transform 0.2s ease"}}),(0,a.jsxs)("div",{className:"absolute top-2 right-2 flex gap-1",children:[(0,a.jsx)(o.$,{variant:"outline",size:"sm",className:"bg-white text-blue-500 hover:bg-blue-100 h-7",onClick:()=>Z(e=>Math.min(e+.1,3)),children:(0,a.jsx)(k.A,{className:"h-4 w-4"})}),(0,a.jsx)(o.$,{variant:"outline",size:"sm",className:"bg-white text-blue-500 hover:bg-blue-100 h-7",onClick:()=>Z(e=>Math.max(e-.1,.5)),children:(0,a.jsx)(C.A,{className:"h-4 w-4"})}),(0,a.jsx)(o.$,{variant:"outline",size:"sm",className:"bg-white text-blue-500 hover:bg-blue-100 h-7",onClick:()=>{G(null),Z(1),et({x:0,y:0})},children:(0,a.jsx)(b.A,{className:"h-4 w-4"})})]})]})}),(0,a.jsx)(O.lG,{open:!!ey,onOpenChange:()=>ew(null),children:(0,a.jsxs)(O.Cf,{className:"sm:max-w-[425px]",children:[(0,a.jsx)(O.c7,{children:(0,a.jsx)(O.L3,{className:"text-base",children:"Message Info"})}),ey&&(0,a.jsxs)("div",{className:"text-sm text-gray-700",children:[(0,a.jsxs)("p",{children:["ID: ",ey.id]}),(0,a.jsxs)("p",{children:["User: ",(null===(s=ey.user)||void 0===s?void 0:s.name)||"Unknown"]}),(0,a.jsxs)("p",{children:["Sent: ",(0,E.GP)(new Date(ey.createdAt),"dd/MM/yyyy HH:mm:ss")]}),(0,a.jsxs)("p",{children:["Seen by: ",ey.seenBy.length>0?ey.seenBy.map(e=>{var t;return(null===(t=e.user)||void 0===t?void 0:t.name)||"Unknown"}).join(", "):"No one"]}),(0,a.jsxs)("p",{children:["Reactions: ",ey.reactions.length>0?ey.reactions.map(e=>{var t;return"".concat(e.emoji," by ").concat((null===(t=e.user)||void 0===t?void 0:t.name)||"Unknown")}).join(", "):"None"]})]})]})}),(0,a.jsxs)("div",{className:"p-4 border-t bg-white chat-input relative",children:[J&&(0,a.jsxs)(T.P.div,{initial:{opacity:0},animate:{opacity:1},className:"text-xs text-gray-500 mb-1 flex items-center gap-1",children:["Replying to ",J.user.name||"Unknown",": ",J.content.slice(0,36),"...",(0,a.jsx)(o.$,{variant:"ghost",size:"sm",className:"p-0 h-5 w-5 hover:bg-gray-200",onClick:()=>K(null),children:(0,a.jsx)(b.A,{className:"h-4 w-4 text-gray-600"})})]}),_.length>0&&(0,a.jsx)(T.P.div,{initial:{opacity:0},animate:{opacity:1},className:"mb-1 flex flex-wrap gap-1",children:_.map((e,t)=>(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(z.default,{src:e,alt:"Preview ".concat(t),width:72,height:72,className:"w-[72px] h-[72px] rounded object-cover cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>G(e)}),(0,a.jsx)(o.$,{variant:"ghost",size:"sm",className:"absolute top-0 right-0 p-0 h-5 w-5 hover:bg-gray-200",onClick:()=>{B(e=>e.filter((e,s)=>s!==t)),R(e=>e.filter((e,s)=>s!==t))},children:(0,a.jsx)(b.A,{className:"h-4 w-4 text-gray-600"})})]},t))}),(0,a.jsxs)("div",{className:"flex gap-1 relative",children:[(0,a.jsx)(o.$,{variant:"ghost",size:"sm",className:"p-1 text-gray-600 hover:bg-gray-200",onClick:()=>{var e;return null===(e=eN.current)||void 0===e?void 0:e.click()},children:(0,a.jsx)(S.A,{className:"h-4 w-4"})}),(0,a.jsx)("input",{type:"file",ref:eN,onChange:e=>{if(e.target.files){let s=Array.from(e.target.files).filter(e=>e.type.startsWith("image/"));if(s.length){var t;R(s),B(s.map(e=>URL.createObjectURL(e))),null===(t=ek.current)||void 0===t||t.focus()}}},accept:"image/*",multiple:!0,className:"hidden"}),(0,a.jsx)(c.p,{ref:ek,value:L,onChange:e=>{F(e.target.value),ez.current&&clearTimeout(ez.current),fetch("/api/community-chatapp/typing",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:eP}),credentials:"include"}),ez.current=setTimeout(()=>{eb(e=>{let t=new Set(e);return t.delete(eP),t})},2e3)},onPaste:e=>{for(let s of e.clipboardData.items)if(s.type.startsWith("image/")){let a=s.getAsFile();if(a){var t;R(e=>[...e,a]),B(e=>[...e,URL.createObjectURL(a)]),null===(t=ek.current)||void 0===t||t.focus(),e.preventDefault()}}else"text/plain"===s.type&&s.getAsString(e=>F(t=>t+e))},placeholder:"Type a message...",className:"flex-1 text-sm border-gray-300 focus:border-blue-500 focus:ring-blue-500 h-10",onKeyDown:e=>"Enter"===e.key&&eU()}),(0,a.jsxs)(o.$,{onClick:eU,disabled:!eO,className:"flex items-center gap-1 transition-colors duration-200 h-10 text-sm ".concat(eO?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-200 text-gray-500 cursor-not-allowed"),children:[ep?(0,a.jsx)(y.A,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(A.A,{className:"h-4 w-4"}),"Send"]})]})]})]}),(0,a.jsxs)("div",{className:"w-full md:w-1/3 lg:w-1/4 flex flex-col bg-white rounded-lg shadow-sm overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-4 border-b bg-gray-50 flex items-center gap-2",children:[(0,a.jsx)(m.A,{className:"h-5 w-5 text-gray-600"}),(0,a.jsxs)("h2",{className:"text-base font-medium text-gray-700",children:["Members (",D.filter(eG).length,")"]})]}),(0,a.jsx)("div",{className:"overflow-y-auto p-2 user-list",children:D.map(e=>{var t,s,i;return(0,a.jsxs)(T.P.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"flex items-center gap-2 p-2 bg-white border border-gray-200 rounded shadow-sm hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)(d.eu,{children:[(0,a.jsx)(d.BK,{src:null!==(i=e.avatar)&&void 0!==i?i:"https://picsum.photos/150"}),(0,a.jsx)(d.q5,{children:(null===(t=e.name)||void 0===t?void 0:t[0])||"U"})]}),(0,a.jsx)("span",{className:"absolute bottom-0 right-0 w-2 h-2 rounded-full border border-white ".concat(eG(e)?"bg-green-500":"bg-red-500")})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-800 truncate",children:e.name||"Unnamed"}),(0,a.jsx)("div",{className:"text-xs text-gray-500 truncate",children:e.email}),(0,a.jsxs)("div",{className:"text-xs text-gray-400",children:["Joined ",(0,U.m)(new Date((null===(s=e.sessions[0])||void 0===s?void 0:s.createdAt)||new Date),{addSuffix:!0})]})]}),(0,a.jsxs)(u.E,{variant:"outline",className:"text-xs shrink-0 bg-gray-50 text-gray-600 border-gray-200",children:[e.maxPhone,"P / ",e.maxPC,"PC"]})]},e.id)})})]})]})}var I=s(4558);function M(){return(0,a.jsxs)("main",{className:"bg-gray-50 h-screen flex flex-col",children:[(0,a.jsx)(I.A,{}),(0,a.jsx)("div",{className:"flex-1 max-w-full ml-0 p-0 overflow-hidden",children:(0,a.jsx)(D,{})})]})}},9777:(e,t,s)=>{"use strict";s.d(t,{E:()=>l});var a=s(4648);s(8068);var i=s(3300),n=s(6895);let r=(0,i.F)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:s,...i}=e;return(0,a.jsx)("div",{className:(0,n.cn)(r({variant:s}),t),...i})}}},e=>{var t=t=>e(e.s=t);e.O(0,[7124,3752,9804,8821,6263,9111,1107,8526,5239,7358],()=>t(715)),_N_E=e.O()}]);