{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/TON/Desktop/WEBCODE/NextJS/TFKey/tf-manager/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\nconst prisma = new PrismaClient();\r\nexport default prisma;\r\n"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,SAAS,IAAI,6HAAA,CAAA,eAAY;uCAChB","debugId":null}},
    {"offset": {"line": 67, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 73, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/TON/Desktop/WEBCODE/NextJS/TFKey/tf-manager/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import NextAuth, { AuthOptions } from \"next-auth\";\nimport GoogleProvider from \"next-auth/providers/google\";\nimport prisma from \"@/lib/prisma\";\n\nexport const authOptions: AuthOptions = {\n  providers: [\n    GoogleProvider({\n      clientId: process.env.GOOGLE_CLIENT_ID!,\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\n    }),\n  ],\n  callbacks: {\n    async signIn({ user, account }) {\n      if (!user.email) return false;\n\n      const existingUser = await prisma.user.findUnique({\n        where: { email: user.email },\n      });\n\n      if (!existingUser) {\n        // Nếu là lần đầu đăng nhập, tạo user mới\n        await prisma.user.create({\n          data: {\n            email: user.email,\n            name: user.name,\n            avatar: user.image,\n            providerId: account?.providerAccountId || \"\",\n            lastLoginTime: new Date(),\n            role: \"user\", // Mặc định role là user\n            currentSessionToken: account?.access_token, // Lưu token phiên đăng nhập mới\n          },\n        });\n      } else {\n        // Nếu đã có user, update thông tin và token\n        await prisma.user.update({\n          where: { email: user.email },\n          data: {\n            lastLoginTime: new Date(),\n            currentSessionToken: account?.access_token, // Cập nhật token mới\n          },\n        });\n      }\n\n      return true;\n    },\n\n    async jwt({ token }) {\n      // Kiểm tra user trong database mỗi lần refresh token\n      const dbUser = await prisma.user.findUnique({\n        where: { email: token.email! },\n      });\n\n      if (dbUser) {\n        token.id = dbUser.id;\n        token.role = dbUser.role; // Lưu role vào token\n        token.currentSessionToken = dbUser.currentSessionToken; // Lưu token hiện tại vào token\n      } else {\n        // Nếu user không tồn tại trong DB, xóa session\n        return {}; // Xóa token, mất session\n      }\n\n      return token;\n    },\n\n    async session({ session, token }) {\n      if (session.user) {\n        session.user.id = token.id as string;\n        session.user.role = token.role as string;\n        session.user.currentSessionToken = token.currentSessionToken as string; // Lưu token vào session\n      }\n      return session;\n    },\n  },\n  session: { strategy: \"jwt\" },\n  secret: process.env.NEXTAUTH_SECRET,\n};\n"],"names":[],"mappings":";;;AACA;AACA;;;AAEO,MAAM,cAA2B;IACtC,WAAW;QACT,CAAA,GAAA,qJAAA,CAAA,UAAc,AAAD,EAAE;YACb,UAAU,QAAQ,GAAG,CAAC,gBAAgB;YACtC,cAAc,QAAQ,GAAG,CAAC,oBAAoB;QAChD;KACD;IACD,WAAW;QACT,MAAM,QAAO,EAAE,IAAI,EAAE,OAAO,EAAE;YAC5B,IAAI,CAAC,KAAK,KAAK,EAAE,OAAO;YAExB,MAAM,eAAe,MAAM,+GAAA,CAAA,UAAM,CAAC,IAAI,CAAC,UAAU,CAAC;gBAChD,OAAO;oBAAE,OAAO,KAAK,KAAK;gBAAC;YAC7B;YAEA,IAAI,CAAC,cAAc;gBACjB,yCAAyC;gBACzC,MAAM,+GAAA,CAAA,UAAM,CAAC,IAAI,CAAC,MAAM,CAAC;oBACvB,MAAM;wBACJ,OAAO,KAAK,KAAK;wBACjB,MAAM,KAAK,IAAI;wBACf,QAAQ,KAAK,KAAK;wBAClB,YAAY,SAAS,qBAAqB;wBAC1C,eAAe,IAAI;wBACnB,MAAM;wBACN,qBAAqB,SAAS;oBAChC;gBACF;YACF,OAAO;gBACL,4CAA4C;gBAC5C,MAAM,+GAAA,CAAA,UAAM,CAAC,IAAI,CAAC,MAAM,CAAC;oBACvB,OAAO;wBAAE,OAAO,KAAK,KAAK;oBAAC;oBAC3B,MAAM;wBACJ,eAAe,IAAI;wBACnB,qBAAqB,SAAS;oBAChC;gBACF;YACF;YAEA,OAAO;QACT;QAEA,MAAM,KAAI,EAAE,KAAK,EAAE;YACjB,qDAAqD;YACrD,MAAM,SAAS,MAAM,+GAAA,CAAA,UAAM,CAAC,IAAI,CAAC,UAAU,CAAC;gBAC1C,OAAO;oBAAE,OAAO,MAAM,KAAK;gBAAE;YAC/B;YAEA,IAAI,QAAQ;gBACV,MAAM,EAAE,GAAG,OAAO,EAAE;gBACpB,MAAM,IAAI,GAAG,OAAO,IAAI,EAAE,qBAAqB;gBAC/C,MAAM,mBAAmB,GAAG,OAAO,mBAAmB,EAAE,+BAA+B;YACzF,OAAO;gBACL,+CAA+C;gBAC/C,OAAO,CAAC,GAAG,yBAAyB;YACtC;YAEA,OAAO;QACT;QAEA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,IAAI,QAAQ,IAAI,EAAE;gBAChB,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;gBAC1B,QAAQ,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI;gBAC9B,QAAQ,IAAI,CAAC,mBAAmB,GAAG,MAAM,mBAAmB,EAAY,wBAAwB;YAClG;YACA,OAAO;QACT;IACF;IACA,SAAS;QAAE,UAAU;IAAM;IAC3B,QAAQ,QAAQ,GAAG,CAAC,eAAe;AACrC","debugId":null}},
    {"offset": {"line": 153, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}